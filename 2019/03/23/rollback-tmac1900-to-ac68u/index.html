<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=twitter:card content="summary"><meta name=twitter:title content="将TM-AC1900刷回RT-AC68U"><meta name=twitter:description content><meta name=twitter:site content="@heartnn"><meta property="og:title" content="将TM-AC1900刷回RT-AC68U &#183; heartnn的自留地"><meta property="og:site_name" content="heartnn的自留地"><meta property="og:url" content="https://www.heartnn.com/2019/03/23/rollback-tmac1900-to-ac68u/"><meta property="og:image" content="https://open.saintic.com/api/bingPic/?picSize=2"><meta property="og:description" content><meta property="og:type" content="article"><meta property="article:published_time" content="2019-03-23T07:32:17+08:00"><meta property="article:tag" content="router"><title>将TM-AC1900刷回RT-AC68U &#183; heartnn的自留地</title><meta name=description content="<p>之前由于入手了树莓派，就给原来的<a href=&#34;/2017/11/23/start-merlin-from-zero-with-syncthing-installed/&#34;>华硕RT-AC68U</a>改成了官方固件，这两天手贱升了一下级，于是路由器被打回了原型，固件变成了3.0.0.4.376_3199(T-M"><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=/images/favicon.ico><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=stylesheet href=/css/screen.min.css><link rel=stylesheet href=/css/nav.min.css><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.4.1/dist/jquery.fancybox.min.css integrity="sha256-oC/Q8nqWSlp1bki3Ht9gRCWaew5n6/HNk10HT4aEX4w=" crossorigin=anonymous><link href=/index.xml rel=alternate type=application/rss+xml title=heartnn的自留地><meta name=generator content="Hugo 0.84.0"><link rel=canonical href=https://www.heartnn.com/2019/03/23/rollback-tmac1900-to-ac68u/><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","publisher":{"@type":"Organization","name":null,"logo":"https://www.heartnn.com/images/logo.png"},"author":{"@type":"Person","name":null,"image":{"@type":"ImageObject","url":"https://www.heartnn.com/images/logo.png","width":250,"height":250},"url":"https://www.heartnn.com","sameAs":[]},"headline":"将TM-AC1900刷回RT-AC68U","name":"将TM-AC1900刷回RT-AC68U","wordCount":1392,"timeRequired":"PT3M","inLanguage":{"@type":"Language","alternateName":"en"},"url":"https://www.heartnn.com/2019/03/23/rollback-tmac1900-to-ac68u/","datePublished":"2019-03-23T07:32Z+08:00","dateModified":"2019-03-23T07:32+08:00","keywords":"router","description":"","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.heartnn.com/2019/03/23/rollback-tmac1900-to-ac68u/"}}</script></head><body class=nav-closed><div class=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Close</span></a><ul><li class=nav-opened role=presentation><a href=/>首页</a></li><li class=nav-opened role=presentation><a href=/aboutme/>关于我</a></li><li class=nav-opened role=presentation><a href=/archives/>归档</a></li><li class=nav-opened role=presentation><a href=/categories/>分类</a></li><li class=nav-opened role=presentation><a href=/tags/>标签</a></li><h3 class=nav-link>Topics</h3><li class=nav-opened role=presentation><a href=/hosts/ title="General Hosts">Hosts</a></li><li class=nav-opened role=presentation><a href=/twitter/ title="About Twitter">Twitter</a></li><li class=nav-opened role=presentation><a href=/playlist/ title=我经常听的歌>播放列表</a></li><h3 class=nav-link>Links</h3><li class=nav-opened role=presentation><a href title onclick="target='_blank'"></a></li></ul><a class="subscribe-button icon-feed" href=/index.xml>Subscribe</a></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head no-cover"><nav class="main-nav clearfix"><a class=blog-logo href=https://www.heartnn.com/><img src=/images/logo.png alt=Home></a>
<a class=menu-button href=#><span class=burger>&#9776;</span><span class=word>Menu</span></a></nav></header><main class=content role=main><article class="post post"><header class=post-header><h1 class=post-title>将TM-AC1900刷回RT-AC68U</h1><small></small><section class=post-meta><time class=post-date datetime=2019-03-23T07:32:17+08:00>2019-03-23</time>
<span class="post-tag small"><a href=https://www.heartnn.com/tags/router/>#router</a></span></section></header><section class=post-content><p>之前由于入手了树莓派，就给原来的<a href=/2017/11/23/start-merlin-from-zero-with-syncthing-installed/>华硕RT-AC68U</a>改成了官方固件，这两天手贱升了一下级，于是路由器被打回了原型，固件变成了3.0.0.4.376_3199(T-Mobile定制版，功能较少)，从网上查了一下，似乎刷旧版固件然后取得ssh的方式不能用了，虽然用起来区别不大，但总觉得不甘心，于是折腾模式开启。</p><h3 id=准备工作>准备工作</h3><p>1. cfe，最好是自己以前备份过的，实在没有可以自己生成一个，我的就是没有备份过，所以只能自己生成了。</p><p>首先下载我提供的<a href=/uploads/2019/03/cfe-1.0.2.0-all-am.7z>CFE模板</a>，然后参照<a href=/uploads/2019/03/cfeedit.png>截图</a>用<a href=https://www.lanzous.com/i3iuogb#4k3p>CFEEdit</a>修改里面的MAC地址和WPS密码。</p><p>本机的MAC地址可以登录<a href=http://cellspot.router/>http://cellspot.router/</a>,然后点WLAN可以查看到，LAN和2.4G的MAC地址似乎是一样的。WPS密码可以参照路由器背面。</p><p>然后打开网站<a href=https://cfeditor.pipeline.sh/>https://cfeditor.pipeline.sh/</a>，把修改好的CFE上传到Original CFE，Source CFE选1.0.2.0 US AiMesh，Country那里可以选择ALL，然后下载Target CFE即可得到自己的CFE，<strong>重命名为new_cfe.bin待用</strong>。</p><p>2. 准备一个FAT32的U盘，将盘符改名为USB，下载<a href=/uploads/2019/03/mtd-write.7z>mtd-write.7z</a>和<a href=https://www.lanzous.com/i3iupta#fb9u>FW_RT_AC68U_30043763626.zip</a>，将new_cfe.bin、mtd-write和FW_RT_AC68U_30043763626.trx三个文件打包为files12345.zip放入U盘中并插到路由器上。</p><h3 id=开始刷写>开始刷写</h3><p>登陆路由器(建议使用Chrome隐身模式，这样不会受到Chrome扩展的影响)，进入网络工具 &ndash;> 网络诊断，右键点检查，会出现开发者工具，点击console标签，开始漫长的输入命令过程。（输入每条命令后按回车，然后点击路由器网页中的“网络诊断”按钮，并建议把ping的地址由www.google.com改为国内网址）。</p><p><img src=/uploads/2019/03/chrome-developer-console.png alt></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\necho hello world&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}    <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>测试功能</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#a6e22e>如果正常路由器网页会显示</span><span style=color:#960050;background-color:#1e0010>“</span><span style=color:#a6e22e>hello</span> <span style=color:#a6e22e>world</span><span style=color:#960050;background-color:#1e0010>”</span>

<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\nmount -t tmpfs tmpfs userRpm&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}
<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\nmount&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}
<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\ncp -a . userRpm&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}
<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\nmount --move userRpm .&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}
<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\nmount&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}
<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\nservice restart_httpd&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}    <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>等待httpd重启</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#a6e22e>似乎需要时间稍长一些</span>

<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\nwget -A txt -r -nH -nd --no-check-certificate tmac1900.heartnn.com&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}    <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>这里我自己做了一个网站</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#a6e22e>原网站wget可能遭遇证书问题</span>

<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\n. u.txt &#34;</span><span style=color:#f92672>+</span>encodeURIComponent(<span style=color:#e6db74>&#39;find /tmp/mnt -name files12345.zip&#39;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/%/g</span>,<span style=color:#e6db74>&#39;..&#39;</span>);<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}    <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>如果显示</span> <span style=color:#a6e22e>sh</span><span style=color:#f92672>:</span> .<span style=color:#f92672>:</span> <span style=color:#a6e22e>line</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>txt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>not</span> <span style=color:#a6e22e>found</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#a6e22e>则证明上一步出现错误</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#a6e22e>正常的话files12345</span>.<span style=color:#a6e22e>zip应该可以挂载了</span>

<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\n. u.txt &#34;</span><span style=color:#f92672>+</span>encodeURIComponent(<span style=color:#e6db74>&#39;unzip -o /tmp/mnt/USB/files12345.zip&#39;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/%/g</span>,<span style=color:#e6db74>&#39;..&#39;</span>);<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}    <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>解压缩</span>

<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\nchmod 755 mtd-write&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}    <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>修改mtd</span><span style=color:#f92672>-</span><span style=color:#a6e22e>write权限</span>

<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\n. u.txt &#34;</span><span style=color:#f92672>+</span>encodeURIComponent(<span style=color:#e6db74>&#34;./mtd-write new_cfe.bin boot&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/%/g</span>,<span style=color:#e6db74>&#39;..&#39;</span>);<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}    <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>刷写CFE</span>

<span style=color:#a6e22e>validForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){document.<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>SystemCmd</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ping\nmtd-write2 FW_RT_AC68U_30043763626.trx linux&#34;</span>;<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;}    <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>刷写固件</span>
</code></pre></div><p>上述步骤完成后等3分钟，关掉电源，按住WPS按钮不放同时开机，继续按住WPS按钮一直到路由后面白色灯闪烁，松开WPS按钮后路由自动重启，成功的话会清除nvram，等待路由重启，至此路由器就恢复好了，且支持AiMesh。</p><h3 id=清除mtd5>清除mtd5</h3><p>通过系统管理打开ssh权限，用ssh工具登录路由器。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cat /dev/mtd5 &gt; /jffs/mtd5_backup.bin
mkdir /tmp/asus_jffs
mount -t jffs2 /dev/mtdblock5 /tmp/asus_jffs
rm -rf /tmp/asus_jffs/*
sync <span style=color:#f92672>&amp;&amp;</span> umount /tmp/asus_jffs
ln -s /sbin/rc mtd-erase
./mtd-erase -d asus    <span style=color:#75715e># 到这个步骤可能会卡住不动，可能是原帖作者恢复成功后又升级了固件</span>
rm -rf /jffs/.sys/RT-AC68U
nvram unset fw_check <span style=color:#f92672>&amp;&amp;</span> nvram commit <span style=color:#f92672>&amp;&amp;</span> reboot
</code></pre></div><p>等待重启，到此大功告成，经测试可以正常升级到<a href=https://www.asus.com/us/Networking/RTAC68U/HelpDesk_BIOS/>3.0.0.4.384.45149</a>(最好是断网升级)。</p><h3 id=参考>参考</h3><ol><li><a href=http://koolshare.cn/thread-137955-1-1.html>http://koolshare.cn/thread-137955-1-1.html</a></li><li><a href=http://koolshare.cn/thread-136906-1-1.html>http://koolshare.cn/thread-136906-1-1.html</a></li><li><a href=https://tmac1900.weebly.com/>https://tmac1900.weebly.com/</a></li></ol><p>附自己搭建的u.txt：<a href=https://dev.tencent.com/u/heartnn/p/tmac1900/git>https://dev.tencent.com/u/heartnn/p/tmac1900/git</a></p></section><footer class=post-footer><figure class=author-image><a class=img href=https://www.heartnn.com/ style=background-image:url(/images/logo.png)><span class=hidden>heartnn's Picture</span></a></figure><section class=author><h4><a href=https://www.heartnn.com/>heartnn</a></h4><p>Read <a href=https://www.heartnn.com/>more posts</a> by this author.</p><div class=author-meta><span class="author-location icon-location">河北, 石家庄</span>
<span class="author-link icon-link"><a href=https://www.heartnn.com>https://www.heartnn.com</a></span></div></section><section class=share><h4>Share this post</h4><a class=icon-twitter style=font-size:1.4em href="https://twitter.com/share?text=%e5%b0%86TM-AC1900%e5%88%b7%e5%9b%9eRT-AC68U&nbsp;-&nbsp;heartnn%e7%9a%84%e8%87%aa%e7%95%99%e5%9c%b0&url=https%3a%2f%2fwww.heartnn.com%2f2019%2f03%2f23%2frollback-tmac1900-to-ac68u%2f" onclick="return window.open(this.href,'twitter-share','width=550,height=235'),!1"><span class=hidden>Twitter</span></a>
<a class=icon-facebook style=font-size:1.4em href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.heartnn.com%2f2019%2f03%2f23%2frollback-tmac1900-to-ac68u%2f" onclick="return window.open(this.href,'facebook-share','width=580,height=296'),!1"><span class=hidden>Facebook</span></a>
<a class=icon-pinterest style=font-size:1.4em href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.heartnn.com%2f2019%2f03%2f23%2frollback-tmac1900-to-ac68u%2f&description=%e5%b0%86TM-AC1900%e5%88%b7%e5%9b%9eRT-AC68U" onclick="return window.open(this.href,'pinterest-share','width=580,height=296'),!1"><span class=hidden>Pinterest</span></a>
<a class=icon-google-plus style=font-size:1.4em href="https://plus.google.com/share?url=https%3a%2f%2fwww.heartnn.com%2f2019%2f03%2f23%2frollback-tmac1900-to-ac68u%2f" onclick="return window.open(this.href,'google-plus-share','width=490,height=530'),!1"><span class=hidden>Google+</span></a></section><div id=vcomments></div></footer></article></main><aside class=read-next><a class=read-next-story style=no-cover href=/2019/03/26/yet-another-way-to-download-qq-comic/><section class=post><h2>另类下载腾讯漫画的方法</h2></section></a><a class="read-next-story prev" style=no-cover href=/2019/02/12/flv-merge/><section class=post><h2>FLV合并的批处理办法</h2></section></a></aside><footer class="site-footer clearfix"><section class=copyright>&copy;2008-2018 heartnn的自留地 &nbsp;&nbsp;&nbsp; <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC&nbsp;BY-NC-SA&nbsp;4.0</a></section><section class=poweredby>Proudly generated by <a class=icon-hugo href=https://gohugo.io>HUGO</a>, with <a class=icon-theme href=https://github.com/vjeantet/hugo-theme-casper>Casper</a> theme</section></footer></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=//cdn.jsdelivr.net/gh/TryGhost/Casper@2.6.2/assets/js/jquery.fitvids.js integrity="sha256-bj/JlIND2F1ZRARRwS8t4d22whMq5QMxT2rGs/hyGKg=" crossorigin=anonymous></script><script src=//cdn.jsdelivr.net/gh/leancloud/javascript-sdk@3.0.4/dist/av-min.js integrity="sha256-2vlmqmaGb3IeprbhwEGB5KVTmXxClaA3zwloXdTaXPQ=" crossorigin=anonymous></script><script src=//cdn.jsdelivr.net/gh/DesertsP/Valine/dist/Valine.min.js></script><script>new Valine({av:AV,el:'#vcomments',emoticon_url:'https://www.heartnn.com/smiles',emoticon_list:["呵呵.png","哈哈.png","吐舌.png","啊.png","酷.png","怒.png","开心.png","汗.png","泪.png","黑线.png","鄙视.png","不高兴.png","真棒.png","钱.png","疑问.png","阴脸.png","吐.png","咦.png","委屈.png","花心.png","呼~.png","笑眼.png","冷.png","太开心.png","滑稽.png","勉强.png","狂汗.png","乖.png","睡觉.png","惊哭.png","升起.png","惊讶.png","喷.png"],app_id:'WmHH4997UnyEsd9H1aACe6rP-gzGzoHsz',app_key:'44mTerRFfQEcXcJ8kvvkeTp0',placeholder:'在此评论～'})</script><script src=/js/index.js></script><script src=//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.4.1/dist/jquery.fancybox.min.js integrity="sha256-iFCrYEMjebIvuiqOp61+L3FN2MH8rfqmzGQ0bN5YTWg=" crossorigin=anonymous></script><script src=/js/fancybox.js></script></body></html>